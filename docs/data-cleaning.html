<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data cleaning |     A general workflow for analysis of primary biodiversity data</title>
  <meta name="description" content="  A general workflow for analysis of primary biodiversity data" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data cleaning |     A general workflow for analysis of primary biodiversity data" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://biodiversitydata-se.github.io/biodiversity-analysis-tools/images/sbdi-logo-orginal-large.png" />
  
  <meta name="github-repo" content="biodiversitydata-se/biodiversity-analysis-tools" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data cleaning |     A general workflow for analysis of primary biodiversity data" />
  
  
  <meta name="twitter:image" content="https://biodiversitydata-se.github.io/biodiversity-analysis-tools/images/sbdi-logo-orginal-large.png" />

<meta name="author" content="Debora Arlt, Alejandro Ruete and Charles Campbell  for the Swedish Biodiversity Data Infrastructure" />


<meta name="date" content="2023-07-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon_io/favicon.ico" type="image/x-icon" />
<link rel="prev" href="the-importance-of-questions-and-sources-of-data.html"/>
<link rel="next" href="fitness-for-use.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Biodiversity analysis tools</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html"><i class="fa fa-check"></i><b>2</b> The importance of questions and sources of data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html#questions"><i class="fa fa-check"></i><b>2.1</b> Questions</a></li>
<li class="chapter" data-level="2.2" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html#taxonomies"><i class="fa fa-check"></i><b>2.2</b> Taxonomies</a></li>
<li class="chapter" data-level="2.3" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html#data-sources"><i class="fa fa-check"></i><b>2.3</b> Data Sources</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html#biodiversity-record-data"><i class="fa fa-check"></i><b>2.3.1</b> Biodiversity record data</a></li>
<li class="chapter" data-level="2.3.2" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html#taxonomic-diversity"><i class="fa fa-check"></i><b>2.3.2</b> Taxonomic diversity</a></li>
<li class="chapter" data-level="2.3.3" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html#functional-diversity"><i class="fa fa-check"></i><b>2.3.3</b> Functional diversity</a></li>
<li class="chapter" data-level="2.3.4" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html#genetic-data-bases"><i class="fa fa-check"></i><b>2.3.4</b> Genetic data bases</a></li>
<li class="chapter" data-level="2.3.5" data-path="the-importance-of-questions-and-sources-of-data.html"><a href="the-importance-of-questions-and-sources-of-data.html#environemntal-data"><i class="fa fa-check"></i><b>2.3.5</b> Environemntal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>3</b> Data cleaning</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-cleaning.html"><a href="data-cleaning.html#resources"><i class="fa fa-check"></i><b>3.1</b> Resources</a></li>
<li class="chapter" data-level="3.2" data-path="data-cleaning.html"><a href="data-cleaning.html#taxonomies-1"><i class="fa fa-check"></i><b>3.2</b> Taxonomies</a></li>
<li class="chapter" data-level="3.3" data-path="data-cleaning.html"><a href="data-cleaning.html#location-data"><i class="fa fa-check"></i><b>3.3</b> Location data</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-cleaning.html"><a href="data-cleaning.html#locality-information"><i class="fa fa-check"></i><b>3.3.1</b> Locality information</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-cleaning.html"><a href="data-cleaning.html#coordinate-uncertainty"><i class="fa fa-check"></i><b>3.3.2</b> Coordinate uncertainty</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-cleaning.html"><a href="data-cleaning.html#coordinate-errors"><i class="fa fa-check"></i><b>3.3.3</b> Coordinate errors</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-cleaning.html"><a href="data-cleaning.html#examples"><i class="fa fa-check"></i><b>3.4</b> Examples</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="data-cleaning.html"><a href="data-cleaning.html#data-cleaning-cyperaceae-in-sweden"><i class="fa fa-check"></i><b>3.4.1</b> Data cleaning Cyperaceae in Sweden</a></li>
<li class="chapter" data-level="3.4.2" data-path="data-cleaning.html"><a href="data-cleaning.html#taxonomy"><i class="fa fa-check"></i><b>3.4.2</b> Taxonomy</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="fitness-for-use.html"><a href="fitness-for-use.html"><i class="fa fa-check"></i><b>4</b> Fitness for use</a>
<ul>
<li class="chapter" data-level="4.1" data-path="fitness-for-use.html"><a href="fitness-for-use.html#bias"><i class="fa fa-check"></i><b>4.1</b> Bias</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-exploration-and-transformation.html"><a href="data-exploration-and-transformation.html"><i class="fa fa-check"></i><b>5</b> Data Exploration and Transformation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-exploration-and-transformation.html"><a href="data-exploration-and-transformation.html#wide"><i class="fa fa-check"></i><b>5.1</b> Wide</a></li>
<li class="chapter" data-level="5.2" data-path="data-exploration-and-transformation.html"><a href="data-exploration-and-transformation.html#long"><i class="fa fa-check"></i><b>5.2</b> Long</a></li>
<li class="chapter" data-level="5.3" data-path="data-exploration-and-transformation.html"><a href="data-exploration-and-transformation.html#wide-to-long"><i class="fa fa-check"></i><b>5.3</b> Wide to long</a></li>
<li class="chapter" data-level="5.4" data-path="data-exploration-and-transformation.html"><a href="data-exploration-and-transformation.html#long-to-wide"><i class="fa fa-check"></i><b>5.4</b> Long to Wide</a></li>
<li class="chapter" data-level="5.5" data-path="data-exploration-and-transformation.html"><a href="data-exploration-and-transformation.html#spatial-data"><i class="fa fa-check"></i><b>5.5</b> Spatial data</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="data-exploration-and-transformation.html"><a href="data-exploration-and-transformation.html#spatial-vector-data"><i class="fa fa-check"></i><b>5.5.1</b> Spatial vector data</a></li>
<li class="chapter" data-level="5.5.2" data-path="data-exploration-and-transformation.html"><a href="data-exploration-and-transformation.html#raster"><i class="fa fa-check"></i><b>5.5.2</b> Raster</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html"><i class="fa fa-check"></i><b>6</b> Essential Biodiversity Variables</a>
<ul>
<li class="chapter" data-level="6.1" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#sdm"><i class="fa fa-check"></i><b>6.1</b> SDM</a></li>
<li class="chapter" data-level="6.2" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#diversity"><i class="fa fa-check"></i><b>6.2</b> Diversity</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#types-of-analyses---patitioning-alpha-beta-gamma-etc.-diversity"><i class="fa fa-check"></i><b>6.2.1</b> Types of analyses - Patitioning <span class="math inline">\(\alpha\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\gamma\)</span> <em>etc.</em> diversity</a></li>
<li class="chapter" data-level="6.2.2" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#data-form"><i class="fa fa-check"></i><b>6.2.2</b> Data form</a></li>
<li class="chapter" data-level="6.2.3" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#classic-diversity-measures"><i class="fa fa-check"></i><b>6.2.3</b> Classic diversity measures</a></li>
<li class="chapter" data-level="6.2.4" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#alpha-diversity"><i class="fa fa-check"></i><b>6.2.4</b> <span class="math inline">\(\alpha\)</span> diversity</a></li>
<li class="chapter" data-level="6.2.5" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#beta-diversity-and-dissimilarities"><i class="fa fa-check"></i><b>6.2.5</b> <span class="math inline">\(\beta\)</span> diversity and dissimilarities</a></li>
<li class="chapter" data-level="6.2.6" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#additional-related-diversities"><i class="fa fa-check"></i><b>6.2.6</b> Additional related diversities</a></li>
<li class="chapter" data-level="6.2.7" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#numbers-equivalents"><i class="fa fa-check"></i><b>6.2.7</b> Numbers equivalents</a></li>
<li class="chapter" data-level="6.2.8" data-path="essential-biodiversity-variables.html"><a href="essential-biodiversity-variables.html#example-of-analysis-of-diversity"><i class="fa fa-check"></i><b>6.2.8</b> Example of analysis of diversity</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="nils-example-1.html"><a href="nils-example-1.html"><i class="fa fa-check"></i><b>7</b> NILS example 1</a>
<ul>
<li class="chapter" data-level="7.1" data-path="nils-example-1.html"><a href="nils-example-1.html#nils-apis-query-data-via-urls"><i class="fa fa-check"></i><b>7.1</b> NILS APIs: query data via urls</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="nils-example-1.html"><a href="nils-example-1.html#all-data-from-endpoint-klasser"><i class="fa fa-check"></i><b>7.1.1</b> All data from endpoint ‘Klasser’</a></li>
<li class="chapter" data-level="7.1.2" data-path="nils-example-1.html"><a href="nils-example-1.html#extrahera-metadata-från-apiet-habitat"><i class="fa fa-check"></i><b>7.1.2</b> Extrahera metadata från apiet habitat</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="nils-example-1.html"><a href="nils-example-1.html#combine-data-from-different-tables"><i class="fa fa-check"></i><b>7.2</b> Combine data from different tables</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="nils-example-2.html"><a href="nils-example-2.html"><i class="fa fa-check"></i><b>8</b> NILS example 2</a>
<ul>
<li class="chapter" data-level="8.1" data-path="nils-example-2.html"><a href="nils-example-2.html#sdm-1"><i class="fa fa-check"></i><b>8.1</b> SDM</a></li>
<li class="chapter" data-level="8.2" data-path="nils-example-2.html"><a href="nils-example-2.html#diversity-1"><i class="fa fa-check"></i><b>8.2</b> Diversity</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><img src='images/sbdi-logo-orginal-large.png' class='cover'/> <br><br> A general workflow for analysis of primary biodiversity data</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-cleaning" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data cleaning<a href="data-cleaning.html#data-cleaning" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Biodiversity data repositories work hard to maintain the accuracy of their holdings. When multiple sources are involved several problems may arise. Here we shall quickly outline what they are and possible solutions.</p>
<div id="resources" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Resources<a href="data-cleaning.html#resources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are a number of libraries, work flows and online resources for automating downloading and cleaning of data. THese include:</p>
<ul>
<li>The <a href="https://bdverse.org/">BDverse</a>. A group of libraries for cleaning biodiversity data</li>
<li><a href="%5Bhttp://kurator.acis.ufl.edu/kurator-web/">Kurator</a></li>
<li><a href="https://wallaceecomod.github.io/">Wallace</a></li>
</ul>
</div>
<div id="taxonomies-1" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Taxonomies<a href="data-cleaning.html#taxonomies-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is important to be aware of likely taxonomic anomalies prior to working within a region. Checklists are very important, especially if working over several regions / countries. Whilst there are many things that will automatically look for the validity of a name they do not check for the validity of that species occurrence. For example <em>Sphagnum auriculatum</em> Schimp. and <em>Sphagnum denticulatum</em> Bridel, 1826 are both valid names. <em>S. auriculatum</em> is the currently accepted species in Europe but in the British Isles, Ireland and the Netherlands <em>s. denticulatum</em> is the most recorded taxa. Both are legitimate names but they are a synonymy. Both names have been used in Europe but in distinct countries. The current European checklist <span class="citation">(<a href="#ref-hodgetts_annotated_2020">Hodgetts et al. 2020</a>)</span> has <em>Sphagnum auriculatum</em> Schimp. as the accepted taxon occurring in Europe. Naive downloading would result in two taxa being present when in fact it is two interpretations of the same taxon. Using data from across the European region without acknowledging this disagreement would impact the results of any research undertaken. For taxa which are known to be capable of dispersing great distances (eg. birds) this becomes even more difficult especially when using community sourced data.</p>
<p><img src="biodiversity-analysis-tools_files/figure-html/start-up-1.png" width="\textwidth" style="display: block; margin: auto;" />
The example above uses data downloaded from GBIF.</p>
<ul>
<li>Data for <em>Sphagnum denticulatum</em> doi: 10.15468/dl.rrp4p4</li>
<li>Data for <em>Sphagnum auriculatum</em> doi: 10.15468/dl.3yrtw7</li>
</ul>
<p>Within Sweden there is an agreed taxonomy for all extant taxa accessible through <a href="https://www.dyntaxa.se">Dyntaxa</a>. Checking of species lists can be done by directly copying species names into a dialogue box or uploading an excel spreadsheet in the correct format.</p>
</div>
<div id="location-data" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Location data<a href="data-cleaning.html#location-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="locality-information" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Locality information<a href="data-cleaning.html#locality-information" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Many records have locality information attached to them. Where there are no coordinates attached this information can be used to locate the record to within an area of where records most likely came from. There are functions for which geocoding can be done automatically within R. Geocoding is finding the coordinate for a known locality. These are included in the libraries:</p>
<ul>
<li><strong>ggmap</strong> <em>requires google API key</em></li>
<li><strong>tidygeocoder</strong></li>
</ul>
<p>Many localities may not be included in the gazetteers associated with these libraries but may be located using online or printed maps. This takes time but may be useful. Unique localities may be extracted, geocoded and then merged back with the data set.</p>
This becomes especially important when extracting records across country boundaries as countries have different numbers of georeferenced observations.
<div class="table table-striped table-hover" style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:350px; overflow-x: scroll; width:100%;  margin-left: auto; margin-right: auto;">
<table>
<caption>
<span id="tab:georef">Table 3.1: </span>The number and percentage of records of bryophyta per EU country with and without coordinates
</caption>
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Country
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
Total Records
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
% Records with coordinate
</th>
<th style="text-align:right;position: sticky; top:0; background-color: #FFFFFF;">
% Records without coordinates
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AL
</td>
<td style="text-align:left;">
Albania
</td>
<td style="text-align:right;">
276
</td>
<td style="text-align:right;">
7.97
</td>
<td style="text-align:right;">
7.97
</td>
</tr>
<tr>
<td style="text-align:left;">
AD
</td>
<td style="text-align:left;">
Andorra
</td>
<td style="text-align:right;">
2340
</td>
<td style="text-align:right;">
7.09
</td>
<td style="text-align:right;">
7.09
</td>
</tr>
<tr>
<td style="text-align:left;">
AM
</td>
<td style="text-align:left;">
Armenia
</td>
<td style="text-align:right;">
388
</td>
<td style="text-align:right;">
44.85
</td>
<td style="text-align:right;">
44.85
</td>
</tr>
<tr>
<td style="text-align:left;">
AT
</td>
<td style="text-align:left;">
Austria
</td>
<td style="text-align:right;">
63417
</td>
<td style="text-align:right;">
21.75
</td>
<td style="text-align:right;">
21.75
</td>
</tr>
<tr>
<td style="text-align:left;">
BY
</td>
<td style="text-align:left;">
Belarus
</td>
<td style="text-align:right;">
1669
</td>
<td style="text-align:right;">
25.40
</td>
<td style="text-align:right;">
25.40
</td>
</tr>
<tr>
<td style="text-align:left;">
BE
</td>
<td style="text-align:left;">
Belgium
</td>
<td style="text-align:right;">
456751
</td>
<td style="text-align:right;">
6.90
</td>
<td style="text-align:right;">
6.90
</td>
</tr>
<tr>
<td style="text-align:left;">
BA
</td>
<td style="text-align:left;">
Bosnia &amp; Herzegovina
</td>
<td style="text-align:right;">
366
</td>
<td style="text-align:right;">
75.41
</td>
<td style="text-align:right;">
75.41
</td>
</tr>
<tr>
<td style="text-align:left;">
BG
</td>
<td style="text-align:left;">
Bulgaria
</td>
<td style="text-align:right;">
1148
</td>
<td style="text-align:right;">
42.33
</td>
<td style="text-align:right;">
42.33
</td>
</tr>
<tr>
<td style="text-align:left;">
HR
</td>
<td style="text-align:left;">
Croatia
</td>
<td style="text-align:right;">
861
</td>
<td style="text-align:right;">
57.38
</td>
<td style="text-align:right;">
57.38
</td>
</tr>
<tr>
<td style="text-align:left;">
CY
</td>
<td style="text-align:left;">
Cyprus
</td>
<td style="text-align:right;">
553
</td>
<td style="text-align:right;">
66.37
</td>
<td style="text-align:right;">
66.37
</td>
</tr>
<tr>
<td style="text-align:left;">
CZ
</td>
<td style="text-align:left;">
Czechia
</td>
<td style="text-align:right;">
17873
</td>
<td style="text-align:right;">
50.46
</td>
<td style="text-align:right;">
50.46
</td>
</tr>
<tr>
<td style="text-align:left;">
DK
</td>
<td style="text-align:left;">
Denmark
</td>
<td style="text-align:right;">
898583
</td>
<td style="text-align:right;">
1.28
</td>
<td style="text-align:right;">
1.28
</td>
</tr>
<tr>
<td style="text-align:left;">
EE
</td>
<td style="text-align:left;">
Estonia
</td>
<td style="text-align:right;">
103057
</td>
<td style="text-align:right;">
37.07
</td>
<td style="text-align:right;">
37.07
</td>
</tr>
<tr>
<td style="text-align:left;">
FO
</td>
<td style="text-align:left;">
Faroe Islands
</td>
<td style="text-align:right;">
1588
</td>
<td style="text-align:right;">
50.25
</td>
<td style="text-align:right;">
50.25
</td>
</tr>
<tr>
<td style="text-align:left;">
FI
</td>
<td style="text-align:left;">
Finland
</td>
<td style="text-align:right;">
227367
</td>
<td style="text-align:right;">
9.06
</td>
<td style="text-align:right;">
9.06
</td>
</tr>
<tr>
<td style="text-align:left;">
FR
</td>
<td style="text-align:left;">
France
</td>
<td style="text-align:right;">
925568
</td>
<td style="text-align:right;">
8.53
</td>
<td style="text-align:right;">
8.53
</td>
</tr>
<tr>
<td style="text-align:left;">
GE
</td>
<td style="text-align:left;">
Georgia
</td>
<td style="text-align:right;">
8199
</td>
<td style="text-align:right;">
39.18
</td>
<td style="text-align:right;">
39.18
</td>
</tr>
<tr>
<td style="text-align:left;">
DE
</td>
<td style="text-align:left;">
Germany
</td>
<td style="text-align:right;">
196782
</td>
<td style="text-align:right;">
19.93
</td>
<td style="text-align:right;">
19.93
</td>
</tr>
<tr>
<td style="text-align:left;">
GI
</td>
<td style="text-align:left;">
Gibraltar
</td>
<td style="text-align:right;">
22
</td>
<td style="text-align:right;">
100.00
</td>
<td style="text-align:right;">
100.00
</td>
</tr>
<tr>
<td style="text-align:left;">
GR
</td>
<td style="text-align:left;">
Greece
</td>
<td style="text-align:right;">
1944
</td>
<td style="text-align:right;">
67.44
</td>
<td style="text-align:right;">
67.44
</td>
</tr>
<tr>
<td style="text-align:left;">
HU
</td>
<td style="text-align:left;">
Hungary
</td>
<td style="text-align:right;">
3629
</td>
<td style="text-align:right;">
64.62
</td>
<td style="text-align:right;">
64.62
</td>
</tr>
<tr>
<td style="text-align:left;">
IS
</td>
<td style="text-align:left;">
Iceland
</td>
<td style="text-align:right;">
42720
</td>
<td style="text-align:right;">
14.97
</td>
<td style="text-align:right;">
14.97
</td>
</tr>
<tr>
<td style="text-align:left;">
IE
</td>
<td style="text-align:left;">
Ireland
</td>
<td style="text-align:right;">
131849
</td>
<td style="text-align:right;">
2.73
</td>
<td style="text-align:right;">
2.73
</td>
</tr>
<tr>
<td style="text-align:left;">
IT
</td>
<td style="text-align:left;">
Italy
</td>
<td style="text-align:right;">
20483
</td>
<td style="text-align:right;">
53.33
</td>
<td style="text-align:right;">
53.33
</td>
</tr>
<tr>
<td style="text-align:left;">
LV
</td>
<td style="text-align:left;">
Latvia
</td>
<td style="text-align:right;">
7250
</td>
<td style="text-align:right;">
44.18
</td>
<td style="text-align:right;">
44.18
</td>
</tr>
<tr>
<td style="text-align:left;">
LI
</td>
<td style="text-align:left;">
Liechtenstein
</td>
<td style="text-align:right;">
581
</td>
<td style="text-align:right;">
3.10
</td>
<td style="text-align:right;">
3.10
</td>
</tr>
<tr>
<td style="text-align:left;">
LT
</td>
<td style="text-align:left;">
Lithuania
</td>
<td style="text-align:right;">
4867
</td>
<td style="text-align:right;">
6.47
</td>
<td style="text-align:right;">
6.47
</td>
</tr>
<tr>
<td style="text-align:left;">
LU
</td>
<td style="text-align:left;">
Luxembourg
</td>
<td style="text-align:right;">
23038
</td>
<td style="text-align:right;">
1.59
</td>
<td style="text-align:right;">
1.59
</td>
</tr>
<tr>
<td style="text-align:left;">
MT
</td>
<td style="text-align:left;">
Malta
</td>
<td style="text-align:right;">
89
</td>
<td style="text-align:right;">
40.45
</td>
<td style="text-align:right;">
40.45
</td>
</tr>
<tr>
<td style="text-align:left;">
MC
</td>
<td style="text-align:left;">
Monaco
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
87.50
</td>
<td style="text-align:right;">
87.50
</td>
</tr>
<tr>
<td style="text-align:left;">
NL
</td>
<td style="text-align:left;">
Netherlands
</td>
<td style="text-align:right;">
857837
</td>
<td style="text-align:right;">
4.15
</td>
<td style="text-align:right;">
4.15
</td>
</tr>
<tr>
<td style="text-align:left;">
MK
</td>
<td style="text-align:left;">
North Macedonia
</td>
<td style="text-align:right;">
260
</td>
<td style="text-align:right;">
23.46
</td>
<td style="text-align:right;">
23.46
</td>
</tr>
<tr>
<td style="text-align:left;">
NO
</td>
<td style="text-align:left;">
Norway
</td>
<td style="text-align:right;">
508434
</td>
<td style="text-align:right;">
29.99
</td>
<td style="text-align:right;">
29.99
</td>
</tr>
<tr>
<td style="text-align:left;">
PL
</td>
<td style="text-align:left;">
Poland
</td>
<td style="text-align:right;">
49221
</td>
<td style="text-align:right;">
31.22
</td>
<td style="text-align:right;">
31.22
</td>
</tr>
<tr>
<td style="text-align:left;">
PT
</td>
<td style="text-align:left;">
Portugal
</td>
<td style="text-align:right;">
253353
</td>
<td style="text-align:right;">
9.75
</td>
<td style="text-align:right;">
9.75
</td>
</tr>
<tr>
<td style="text-align:left;">
RO
</td>
<td style="text-align:left;">
Romania
</td>
<td style="text-align:right;">
1449
</td>
<td style="text-align:right;">
60.39
</td>
<td style="text-align:right;">
60.39
</td>
</tr>
<tr>
<td style="text-align:left;">
RU
</td>
<td style="text-align:left;">
Russia
</td>
<td style="text-align:right;">
207613
</td>
<td style="text-align:right;">
15.16
</td>
<td style="text-align:right;">
15.16
</td>
</tr>
<tr>
<td style="text-align:left;">
SM
</td>
<td style="text-align:left;">
San Marino
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
</tr>
<tr>
<td style="text-align:left;">
SK
</td>
<td style="text-align:left;">
Slovakia
</td>
<td style="text-align:right;">
4401
</td>
<td style="text-align:right;">
58.71
</td>
<td style="text-align:right;">
58.71
</td>
</tr>
<tr>
<td style="text-align:left;">
SI
</td>
<td style="text-align:left;">
Slovenia
</td>
<td style="text-align:right;">
3673
</td>
<td style="text-align:right;">
39.75
</td>
<td style="text-align:right;">
39.75
</td>
</tr>
<tr>
<td style="text-align:left;">
ES
</td>
<td style="text-align:left;">
Spain
</td>
<td style="text-align:right;">
112576
</td>
<td style="text-align:right;">
23.32
</td>
<td style="text-align:right;">
23.32
</td>
</tr>
<tr>
<td style="text-align:left;">
SE
</td>
<td style="text-align:left;">
Sweden
</td>
<td style="text-align:right;">
1153645
</td>
<td style="text-align:right;">
9.75
</td>
<td style="text-align:right;">
9.75
</td>
</tr>
<tr>
<td style="text-align:left;">
CH
</td>
<td style="text-align:left;">
Switzerland
</td>
<td style="text-align:right;">
279286
</td>
<td style="text-align:right;">
4.13
</td>
<td style="text-align:right;">
4.13
</td>
</tr>
<tr>
<td style="text-align:left;">
TR
</td>
<td style="text-align:left;">
Turkey
</td>
<td style="text-align:right;">
9230
</td>
<td style="text-align:right;">
94.05
</td>
<td style="text-align:right;">
94.05
</td>
</tr>
<tr>
<td style="text-align:left;">
UA
</td>
<td style="text-align:left;">
Ukraine
</td>
<td style="text-align:right;">
10476
</td>
<td style="text-align:right;">
10.74
</td>
<td style="text-align:right;">
10.74
</td>
</tr>
<tr>
<td style="text-align:left;">
GB
</td>
<td style="text-align:left;">
United Kingdom
</td>
<td style="text-align:right;">
2964596
</td>
<td style="text-align:right;">
1.42
</td>
<td style="text-align:right;">
1.42
</td>
</tr>
<tr>
<td style="text-align:left;">
VA
</td>
<td style="text-align:left;">
Vatican City
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
100.00
</td>
<td style="text-align:right;">
100.00
</td>
</tr>
</tbody>
</table>
</div>
<p>As can be seen from the above example for European Bryophyta (Hornworts, Liverworts and Mosses) the number of records with coordinates vastly varies between countries. For example of 959444 records in Sweden 88.24 % have coordinates in Switzerland of 117132 records only 2.29 % have coordinates.</p>
</div>
<div id="coordinate-uncertainty" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Coordinate uncertainty<a href="data-cleaning.html#coordinate-uncertainty" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In many cases there is now an abundance of biodiversity data with coordinates. As can be seen from a summary of the above <em>Sphagnum</em> data coordinate uncertainty can vary from less than 1 meter to multiple kilometers.</p>
<table class="table table table-striped table-hover" style="margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto;">
<tbody>
<tr>
<td style="text-align:left;">
Coordinate uncertainty
</td>
<td style="text-align:left;">
&lt;1 m
</td>
<td style="text-align:left;">
1-10 m
</td>
<td style="text-align:left;">
10-100 m
</td>
<td style="text-align:left;">
100-500 m
</td>
<td style="text-align:left;">
500-1000 m
</td>
<td style="text-align:left;">
1-5 km
</td>
<td style="text-align:left;">
5-10 km
</td>
<td style="text-align:left;">
10-50 km
</td>
<td style="text-align:left;">
&gt;50 km
</td>
<td style="text-align:left;">
None
</td>
</tr>
<tr>
<td style="text-align:left;">
Frequency
</td>
<td style="text-align:left;">
335
</td>
<td style="text-align:left;">
586
</td>
<td style="text-align:left;">
5320
</td>
<td style="text-align:left;">
376
</td>
<td style="text-align:left;">
4619
</td>
<td style="text-align:left;">
4980
</td>
<td style="text-align:left;">
4147
</td>
<td style="text-align:left;">
41
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:left;">
7506
</td>
</tr>
</tbody>
</table>
<p>In the above example it can be seen that two have uncertainties greater than 50 km and several thousand records that have no known error margin the location. It is important to consider what the error is and removing those records for which the uncertainty is too high. Where this point is will be dependent on the scale of the research.</p>
<!-- Coordinates with NA as the uncertainty and those that fall below a particular threshold may be removed by: -->
</div>
<div id="coordinate-errors" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Coordinate errors<a href="data-cleaning.html#coordinate-errors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Besides the declared uncertainty of the the coordinates, coordinate errors may occur for a variety of reasons. The library <strong>coordinateCleaner</strong> is very useful for removing some of the most common errors. These include:</p>
<ul>
<li>0 latitude, 0 longitude</li>
<li>swapping of latitude and longitude</li>
<li>The location of the institution holding a preserved sample rather than the location of origin of that sample</li>
</ul>
</div>
</div>
<div id="examples" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Examples<a href="data-cleaning.html#examples" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="data-cleaning-cyperaceae-in-sweden" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Data cleaning Cyperaceae in Sweden<a href="data-cleaning.html#data-cleaning-cyperaceae-in-sweden" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this example I have downloaded the occurrences of the Cyperaceae family in Sweden from SBDI since 2000. This is a single data set from an area with an agreed taxonomy <a href="www.dyntaxa.se">dyntaxa</a>. Our aim here is to download a group of records and clean them to be in such a state than they reflect the question the researcher has in mind.</p>
<p>First we give each record in the assembled data set a unique ID. In this case it could be possible to use the GBIFid. In data sets sourced from multiple sources it is a good idea to create a unique ID related to the data source.</p>
<p>In cleaning data there are a number of dimensions of uncertainty we shall first check.</p>
</div>
<div id="taxonomy" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Taxonomy<a href="data-cleaning.html#taxonomy" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the species column there are records with no Species given in the species column. We then check the <code>scientificName</code> for whether there is useful information there</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-cleaning.html#cb1-1" tabindex="-1"></a><span class="fu">kable</span>(Carex <span class="sc">|&gt;</span></span>
<span id="cb1-2"><a href="data-cleaning.html#cb1-2" tabindex="-1"></a>  <span class="fu">filter</span>(species <span class="sc">==</span> <span class="st">&quot;&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb1-3"><a href="data-cleaning.html#cb1-3" tabindex="-1"></a>  <span class="fu">distinct</span>(scientificName)) <span class="sc">|&gt;</span></span>
<span id="cb1-4"><a href="data-cleaning.html#cb1-4" tabindex="-1"></a>   <span class="fu">kable_styling</span>(<span class="at">latex_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hold_position&quot;</span>),</span>
<span id="cb1-5"><a href="data-cleaning.html#cb1-5" tabindex="-1"></a>                <span class="at">full_width =</span> F)</span></code></pre></div>
<table class="table" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
scientificName
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Carex divulsa subsp. leersii (F.W.Schultz) W.Koch
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex L.
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex saxatilis var. saxatilis
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex fuliginosa subsp. misandra (R.Br.) Nyman
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex bigelowii subsp. rigida (Raf.) W.Schultze-Motel
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex buxbaumii subsp. mutica (Hartm.) Isov.
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex buxbaumii f. buxbaumii
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex norvegica subsp. inferalpina (Wahlenb.) Hultén
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex diandra var. major (W.D.J.Koch) Boott
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex buxbaumii var. mutica Hartm.
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex cognata var. congolensis (Turrill) Lye
</td>
</tr>
<tr>
<td style="text-align:left;">
Carex saxatilis subsp. laxa (Trautv.) Kalela
</td>
</tr>
</tbody>
</table>
<p>In this case there are only genre recorded.</p>
<p>We then check for data about species in the locality information for which there are no species data given in the species column. Here there are enough unique values to be checked easily within R. It is possible that in large data sets that there may be very many records for which there is useful information</p>
<p>There are no species data in the locality field and so we begin a vector of IDs that are not at the required data resolution.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-cleaning.html#cb2-1" tabindex="-1"></a>unUseful <span class="ot">&lt;-</span> Carex <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="data-cleaning.html#cb2-2" tabindex="-1"></a>            <span class="fu">filter</span>(scientificName <span class="sc">==</span> <span class="st">&quot;&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="data-cleaning.html#cb2-3" tabindex="-1"></a>            <span class="fu">select</span>(id)</span></code></pre></div>
<p>We now need to check that the species names in the records that we are using are valid for the area which we are looking at i.e. Sweden. There are several resources out there that do this. As we are looking specifically and solely at Sweden there is <a href="https://www.dyntaxa.se/">Dyntaxa.se</a>. There is also an R package as part of the <a href="https://github.com/biodiversitydata-se/SBDI4R">Swedish Biodiversity Data Infrastructure</a> with examples and documentation. For wider applicability we will export the unique names from the Carex data frame. These will then be copied to the <a href="https://www.dyntaxa.se/Match/Settings/0">Dyntaxa portal</a> for matching multiple names. The results are checked against the Swedish lists and unknown species or uncertainties are flagged. Names can be copied directly into a box in Dyntaxa or may be imported directly as an <code>xlsx</code> file. Here we shall export just the species names. There are multiple options.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-cleaning.html#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="data-cleaning.html#cb3-2" tabindex="-1"></a>SpeciesNames <span class="ot">&lt;-</span> Carex <span class="sc">|&gt;</span></span>
<span id="cb3-3"><a href="data-cleaning.html#cb3-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>id <span class="sc">%in%</span> unUseful) <span class="sc">|&gt;</span></span>
<span id="cb3-4"><a href="data-cleaning.html#cb3-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">&quot;scientificName&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-5"><a href="data-cleaning.html#cb3-5" tabindex="-1"></a>  <span class="fu">distinct</span>()</span>
<span id="cb3-6"><a href="data-cleaning.html#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="data-cleaning.html#cb3-7" tabindex="-1"></a><span class="co"># library(openxlsx)</span></span>
<span id="cb3-8"><a href="data-cleaning.html#cb3-8" tabindex="-1"></a><span class="co">#write.xlsx(SpeciesNames,&quot;./data/BDcleaner_Scripts/Example/UniqueCarexTaxa.xlsx&quot;)</span></span></code></pre></div>
<p>Dyntaxa provides options for any taxononmic uncertainties and lists the species for which no match can be made. Having made selections it exports as a <code>.xlslx</code> file. We can then check what those species for which there is no information about what they are. In this case there are an number of species which are likely to be horticultural, a few taxa which are of hybrid origin which are in the Dyntaxa with the addition of ‘×’ between genus and species, and <em>Carex utriculata</em> a species from North America. This last could be a misidentification of <em>C. rostrata</em>. We will exclude the horticultural and uncertain species. We do this by adding a <strong>Species</strong> column in the Dyntaxa file and then load that file into R.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-cleaning.html#cb4-1" tabindex="-1"></a><span class="fu">library</span>(openxlsx)</span>
<span id="cb4-2"><a href="data-cleaning.html#cb4-2" tabindex="-1"></a>SpeciesNames <span class="ot">&lt;-</span> <span class="fu">read.xlsx</span>(<span class="st">&quot;./data/matchCarex.xlsx&quot;</span>) <span class="co"># From Dyntaxa</span></span>
<span id="cb4-3"><a href="data-cleaning.html#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="data-cleaning.html#cb4-4" tabindex="-1"></a>Carex <span class="ot">&lt;-</span> <span class="fu">merge</span>(Carex, </span>
<span id="cb4-5"><a href="data-cleaning.html#cb4-5" tabindex="-1"></a>               SpeciesNames[,<span class="fu">c</span>(<span class="st">&quot;Provided.string&quot;</span>,<span class="st">&quot;SpeciesDyn&quot;</span>)],</span>
<span id="cb4-6"><a href="data-cleaning.html#cb4-6" tabindex="-1"></a>               <span class="at">by.x =</span> <span class="st">&quot;species&quot;</span>,<span class="at">by.y =</span> <span class="st">&quot;Provided.string&quot;</span>,</span>
<span id="cb4-7"><a href="data-cleaning.html#cb4-7" tabindex="-1"></a>               <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>We then add IDs of the rows with taxa which are to be excluded to the unUseful vector. It is possible that there is overlap between these vectors. Rather than overwriting the vector we join the vectors together and use unique to get a vector with no duplications.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-cleaning.html#cb5-1" tabindex="-1"></a>unUseful <span class="ot">&lt;-</span> <span class="fu">unique</span>(</span>
<span id="cb5-2"><a href="data-cleaning.html#cb5-2" tabindex="-1"></a>  <span class="fu">c</span>(unUseful, </span>
<span id="cb5-3"><a href="data-cleaning.html#cb5-3" tabindex="-1"></a>    Carex <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="data-cleaning.html#cb5-4" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="fu">is.na</span>(SpeciesDyn)) <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="data-cleaning.html#cb5-5" tabindex="-1"></a>      <span class="fu">select</span>(id)</span>
<span id="cb5-6"><a href="data-cleaning.html#cb5-6" tabindex="-1"></a>    )</span>
<span id="cb5-7"><a href="data-cleaning.html#cb5-7" tabindex="-1"></a>  )</span></code></pre></div>
<p>###Coordinate Cleaning</p>
<p>We need to extract locality data for rows where there is no lat/lon information to geocode it, producing a latitude and longitude for each locality. This can be carried out in a similar way as for species ie the merging of data frames. This can be also be done automatically in R using the geocode feature of the libraries tidygeocoder or ggmap. Some of these services require an API key (eg. Google). See the documentation for the link for more information</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-cleaning.html#cb6-1" tabindex="-1"></a>Localities <span class="ot">&lt;-</span> Carex <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="data-cleaning.html#cb6-2" tabindex="-1"></a>              <span class="fu">filter</span>(<span class="fu">is.na</span>(longitude)) <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="data-cleaning.html#cb6-3" tabindex="-1"></a>              <span class="fu">select</span>(locality) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="data-cleaning.html#cb6-4" tabindex="-1"></a>              <span class="fu">distinct</span>()</span>
<span id="cb6-5"><a href="data-cleaning.html#cb6-5" tabindex="-1"></a><span class="fu">write.csv</span>(Localities,<span class="st">&quot;./data/Localities.csv&quot;</span>,<span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>For brevity we will simply include the records with no lat/lon info in the unUseful vector. These will ultimately not be used.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-cleaning.html#cb7-1" tabindex="-1"></a>unUseful <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(unUseful,</span>
<span id="cb7-2"><a href="data-cleaning.html#cb7-2" tabindex="-1"></a>                     Carex <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="data-cleaning.html#cb7-3" tabindex="-1"></a>                       <span class="fu">filter</span>(<span class="fu">is.na</span>(latitude)) <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="data-cleaning.html#cb7-4" tabindex="-1"></a>                       <span class="fu">select</span>(id)</span>
<span id="cb7-5"><a href="data-cleaning.html#cb7-5" tabindex="-1"></a>                     )</span>
<span id="cb7-6"><a href="data-cleaning.html#cb7-6" tabindex="-1"></a>                   )</span></code></pre></div>
<p>Before cleaning the coordinates we simplify the data retaining columns that have information directly related to the collection of the data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-cleaning.html#cb8-1" tabindex="-1"></a>Carex <span class="ot">&lt;-</span> Carex <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="data-cleaning.html#cb8-2" tabindex="-1"></a>          <span class="fu">select</span>(id, </span>
<span id="cb8-3"><a href="data-cleaning.html#cb8-3" tabindex="-1"></a>                 SpeciesDyn,</span>
<span id="cb8-4"><a href="data-cleaning.html#cb8-4" tabindex="-1"></a>                 longitude,</span>
<span id="cb8-5"><a href="data-cleaning.html#cb8-5" tabindex="-1"></a>                 latitude,</span>
<span id="cb8-6"><a href="data-cleaning.html#cb8-6" tabindex="-1"></a>                 coordinateUncertaintyInMetres,</span>
<span id="cb8-7"><a href="data-cleaning.html#cb8-7" tabindex="-1"></a>                 locality,</span>
<span id="cb8-8"><a href="data-cleaning.html#cb8-8" tabindex="-1"></a>                 <span class="co"># recordedBy,</span></span>
<span id="cb8-9"><a href="data-cleaning.html#cb8-9" tabindex="-1"></a>                 <span class="co"># countryCode,</span></span>
<span id="cb8-10"><a href="data-cleaning.html#cb8-10" tabindex="-1"></a>                 <span class="co"># eventDate,</span></span>
<span id="cb8-11"><a href="data-cleaning.html#cb8-11" tabindex="-1"></a>                 year,</span>
<span id="cb8-12"><a href="data-cleaning.html#cb8-12" tabindex="-1"></a>                 month,</span>
<span id="cb8-13"><a href="data-cleaning.html#cb8-13" tabindex="-1"></a>                 day,</span>
<span id="cb8-14"><a href="data-cleaning.html#cb8-14" tabindex="-1"></a>                 institutionCode,</span>
<span id="cb8-15"><a href="data-cleaning.html#cb8-15" tabindex="-1"></a>                 collectionCode,</span>
<span id="cb8-16"><a href="data-cleaning.html#cb8-16" tabindex="-1"></a>                 catalogueNumber)</span></code></pre></div>
<p>We then filter out the data rows for which we can not use ie those of too great taxonomic uncertainty. The data may then be cleaned.</p>
<p>There are a number of things to consider when cleaning data:</p>
<ul>
<li>How precise are the locations? Coordinate uncertainty ranges in the Cyperaceae of Sweden from 1 m - 30.5 km.</li>
<li>Are interpreted coordinates sufficient? These interpreted coordinates may imply a greater precision than is necessarily true</li>
<li>Are the locations likely to be errors? Errors can relate to where a sample is (eg. herbarium location) rather than where it came from.</li>
<li>Are the locations in the country claimed? This can arise through swapping of lat and lon; duplication of latitude numbers in the longitude; or simply incorrect coordinates being given.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-cleaning.html#cb9-1" tabindex="-1"></a>unUseful <span class="ot">&lt;-</span> <span class="fu">unique</span>( <span class="fu">c</span>(unUseful, </span>
<span id="cb9-2"><a href="data-cleaning.html#cb9-2" tabindex="-1"></a>                      Carex <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="data-cleaning.html#cb9-3" tabindex="-1"></a>                        <span class="fu">filter</span>(<span class="fu">is.na</span>(coordinateUncertaintyInMetres)) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="data-cleaning.html#cb9-4" tabindex="-1"></a>                        <span class="fu">select</span>(id)</span>
<span id="cb9-5"><a href="data-cleaning.html#cb9-5" tabindex="-1"></a>                      )</span>
<span id="cb9-6"><a href="data-cleaning.html#cb9-6" tabindex="-1"></a>                    )</span>
<span id="cb9-7"><a href="data-cleaning.html#cb9-7" tabindex="-1"></a><span class="co"># kable( t(table( round( Carex$coordinateUncertaintyInMetres, -2))))</span></span></code></pre></div>
<p>We shall filter out all records with unknown coordinate uncertainty and all with a coordinate uncertainty more than 12.5 km.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-cleaning.html#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="data-cleaning.html#cb10-2" tabindex="-1"></a>unUseful <span class="ot">&lt;-</span> <span class="fu">unique</span>( </span>
<span id="cb10-3"><a href="data-cleaning.html#cb10-3" tabindex="-1"></a>  <span class="fu">c</span>(unUseful, </span>
<span id="cb10-4"><a href="data-cleaning.html#cb10-4" tabindex="-1"></a>    Carex <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="data-cleaning.html#cb10-5" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="fu">is.na</span>(coordinateUncertaintyInMetres)) <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a href="data-cleaning.html#cb10-6" tabindex="-1"></a>      <span class="fu">select</span>(id)</span>
<span id="cb10-7"><a href="data-cleaning.html#cb10-7" tabindex="-1"></a>    )</span>
<span id="cb10-8"><a href="data-cleaning.html#cb10-8" tabindex="-1"></a>  )</span>
<span id="cb10-9"><a href="data-cleaning.html#cb10-9" tabindex="-1"></a>unUseful <span class="ot">&lt;-</span> <span class="fu">unique</span>( </span>
<span id="cb10-10"><a href="data-cleaning.html#cb10-10" tabindex="-1"></a>  <span class="fu">c</span>(unUseful, </span>
<span id="cb10-11"><a href="data-cleaning.html#cb10-11" tabindex="-1"></a>    Carex <span class="sc">|&gt;</span></span>
<span id="cb10-12"><a href="data-cleaning.html#cb10-12" tabindex="-1"></a>      <span class="fu">filter</span>(coordinateUncertaintyInMetres  <span class="sc">&gt;</span> <span class="dv">12500</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-13"><a href="data-cleaning.html#cb10-13" tabindex="-1"></a>      <span class="fu">select</span>(id)</span>
<span id="cb10-14"><a href="data-cleaning.html#cb10-14" tabindex="-1"></a>    )</span>
<span id="cb10-15"><a href="data-cleaning.html#cb10-15" tabindex="-1"></a>  )</span></code></pre></div>
<p>We now have an index of records we can’t use owing to incomplete taxonomy or incomplete location information. We save these before cleaning the coordinates.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-cleaning.html#cb11-1" tabindex="-1"></a><span class="fu">save</span>(unUseful, <span class="at">file =</span> <span class="st">&quot;./data/Cyperacea_SWE_unsuseful.rdata&quot;</span>)</span></code></pre></div>
<p>We first remove the already labeled inaccurate data.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-cleaning.html#cb12-1" tabindex="-1"></a>Carex <span class="ot">&lt;-</span> Carex[<span class="sc">-</span><span class="fu">which</span>(Carex<span class="sc">$</span>id <span class="sc">%in%</span> unUseful),]</span></code></pre></div>
<p>We then use the library CoordinateCleaner to automatically flag coordinates that may be errors. Outputs of this can be a cleaned data.frame or additional columns with doubtful records flagged.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-cleaning.html#cb13-1" tabindex="-1"></a>Carex<span class="sc">$</span>countryCode <span class="ot">&lt;-</span> countrycode<span class="sc">::</span><span class="fu">countrycode</span>(Carex<span class="sc">$</span>countryCode,<span class="st">&quot;iso2c&quot;</span>,<span class="st">&quot;iso3c&quot;</span>) <span class="co">#converts ISO2 country codes to ISO3</span></span>
<span id="cb13-2"><a href="data-cleaning.html#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="data-cleaning.html#cb13-3" tabindex="-1"></a>Carex <span class="ot">&lt;-</span> Carex <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="data-cleaning.html#cb13-4" tabindex="-1"></a>          <span class="fu">filter</span>(<span class="sc">!</span>id <span class="sc">%in%</span> unUseful)</span>
<span id="cb13-5"><a href="data-cleaning.html#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="data-cleaning.html#cb13-6" tabindex="-1"></a>Carex <span class="ot">&lt;-</span> Carex[<span class="sc">-</span><span class="fu">which</span>(<span class="fu">is.na</span>(Carex<span class="sc">$</span>latitude)),]</span>
<span id="cb13-7"><a href="data-cleaning.html#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="data-cleaning.html#cb13-8" tabindex="-1"></a>Carex <span class="ot">&lt;-</span> <span class="fu">clean_coordinates</span>(Carex,</span>
<span id="cb13-9"><a href="data-cleaning.html#cb13-9" tabindex="-1"></a>                  <span class="at">lon =</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb13-10"><a href="data-cleaning.html#cb13-10" tabindex="-1"></a>                  <span class="at">lat =</span> <span class="st">&quot;latitude&quot;</span>,</span>
<span id="cb13-11"><a href="data-cleaning.html#cb13-11" tabindex="-1"></a>                  <span class="at">species =</span> <span class="st">&quot;SpeciesDyn&quot;</span>,</span>
<span id="cb13-12"><a href="data-cleaning.html#cb13-12" tabindex="-1"></a>                  <span class="at">countries =</span> <span class="st">&quot;countryCode&quot;</span>,</span>
<span id="cb13-13"><a href="data-cleaning.html#cb13-13" tabindex="-1"></a>                  <span class="at">tests =</span> <span class="fu">c</span>(<span class="st">&quot;capitals&quot;</span>, <span class="st">&quot;centroids&quot;</span>, <span class="st">&quot;equal&quot;</span>, <span class="st">&quot;gbif&quot;</span>, <span class="st">&quot;institutions&quot;</span>,</span>
<span id="cb13-14"><a href="data-cleaning.html#cb13-14" tabindex="-1"></a>                            <span class="st">&quot;outliers&quot;</span>, <span class="st">&quot;seas&quot;</span>, <span class="st">&quot;zeros&quot;</span>,<span class="st">&quot;countries&quot;</span>)</span>
<span id="cb13-15"><a href="data-cleaning.html#cb13-15" tabindex="-1"></a>                  )</span>
<span id="cb13-16"><a href="data-cleaning.html#cb13-16" tabindex="-1"></a></span>
<span id="cb13-17"><a href="data-cleaning.html#cb13-17" tabindex="-1"></a><span class="fu">kable</span>( Carex <span class="sc">|&gt;</span></span>
<span id="cb13-18"><a href="data-cleaning.html#cb13-18" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Invalid coords</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.val<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-19"><a href="data-cleaning.html#cb13-19" tabindex="-1"></a>            <span class="st">`</span><span class="at">Equal coords</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.equ<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-20"><a href="data-cleaning.html#cb13-20" tabindex="-1"></a>            <span class="st">`</span><span class="at">0 coords</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.zer<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-21"><a href="data-cleaning.html#cb13-21" tabindex="-1"></a>            <span class="st">`</span><span class="at">capitals</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.cap<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-22"><a href="data-cleaning.html#cb13-22" tabindex="-1"></a>            <span class="st">`</span><span class="at">country centre</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.cen<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-23"><a href="data-cleaning.html#cb13-23" tabindex="-1"></a>            <span class="st">`</span><span class="at">Country Border</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.con<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-24"><a href="data-cleaning.html#cb13-24" tabindex="-1"></a>            <span class="st">`</span><span class="at">outlier</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.otl<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-25"><a href="data-cleaning.html#cb13-25" tabindex="-1"></a>            <span class="st">`</span><span class="at">Gbif HQ</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.gbf<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-26"><a href="data-cleaning.html#cb13-26" tabindex="-1"></a>            <span class="st">`</span><span class="at">Insitution</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.inst<span class="sc">==</span><span class="cn">FALSE</span>),</span>
<span id="cb13-27"><a href="data-cleaning.html#cb13-27" tabindex="-1"></a>            <span class="st">`</span><span class="at">Summary</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(.summary<span class="sc">==</span><span class="cn">FALSE</span>)), </span>
<span id="cb13-28"><a href="data-cleaning.html#cb13-28" tabindex="-1"></a>  <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Invalid coords&quot;</span>,<span class="st">&quot;Equal coords&quot;</span>,<span class="st">&quot;0 coords&quot;</span>,<span class="st">&quot;capitals&quot;</span>, </span>
<span id="cb13-29"><a href="data-cleaning.html#cb13-29" tabindex="-1"></a>                <span class="st">&quot;country centre&quot;</span>,<span class="st">&quot;Country Border&quot;</span>,<span class="st">&quot;outlier&quot;</span>,<span class="st">&quot;Gbif HQ&quot;</span>,</span>
<span id="cb13-30"><a href="data-cleaning.html#cb13-30" tabindex="-1"></a>                <span class="st">&quot;Insitution&quot;</span>, <span class="st">&quot;Summary&quot;</span>))</span></code></pre></div>
<p>Checking the distribution of the observations</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-cleaning.html#cb14-1" tabindex="-1"></a></span>
<span id="cb14-2"><a href="data-cleaning.html#cb14-2" tabindex="-1"></a>Sweden <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">getData</span>(<span class="st">&quot;GADM&quot;</span>, </span>
<span id="cb14-3"><a href="data-cleaning.html#cb14-3" tabindex="-1"></a>                  <span class="at">country =</span> <span class="st">&quot;SWE&quot;</span>,</span>
<span id="cb14-4"><a href="data-cleaning.html#cb14-4" tabindex="-1"></a>                  <span class="at">path =</span> <span class="st">&quot;./data/&quot;</span>,</span>
<span id="cb14-5"><a href="data-cleaning.html#cb14-5" tabindex="-1"></a>                  <span class="at">level =</span> <span class="dv">0</span>)</span>
<span id="cb14-6"><a href="data-cleaning.html#cb14-6" tabindex="-1"></a>Sweden_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(Sweden)</span>
<span id="cb14-7"><a href="data-cleaning.html#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="data-cleaning.html#cb14-8" tabindex="-1"></a>BolMar <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Sweden_sf) <span class="sc">+</span></span>
<span id="cb14-9"><a href="data-cleaning.html#cb14-9" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb14-10"><a href="data-cleaning.html#cb14-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> Carex <span class="sc">|&gt;</span></span>
<span id="cb14-11"><a href="data-cleaning.html#cb14-11" tabindex="-1"></a>                <span class="fu">filter</span>(SpeciesDyn <span class="sc">==</span> <span class="st">&quot;Carex capillaris&quot;</span>),<span class="co"># |&gt;</span></span>
<span id="cb14-12"><a href="data-cleaning.html#cb14-12" tabindex="-1"></a>                <span class="co"># filter(.con == FALSE),</span></span>
<span id="cb14-13"><a href="data-cleaning.html#cb14-13" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> longitude,</span>
<span id="cb14-14"><a href="data-cleaning.html#cb14-14" tabindex="-1"></a>                 <span class="at">y =</span> latitude)) <span class="sc">+</span></span>
<span id="cb14-15"><a href="data-cleaning.html#cb14-15" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb14-16"><a href="data-cleaning.html#cb14-16" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Carex capillaris&quot;</span>)</span>
<span id="cb14-17"><a href="data-cleaning.html#cb14-17" tabindex="-1"></a></span>
<span id="cb14-18"><a href="data-cleaning.html#cb14-18" tabindex="-1"></a>CarAct <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(Sweden_sf) <span class="sc">+</span></span>
<span id="cb14-19"><a href="data-cleaning.html#cb14-19" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb14-20"><a href="data-cleaning.html#cb14-20" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> Carex <span class="sc">|&gt;</span></span>
<span id="cb14-21"><a href="data-cleaning.html#cb14-21" tabindex="-1"></a>              <span class="fu">filter</span>(SpeciesDyn <span class="sc">==</span> <span class="st">&quot;Carex acuta&quot;</span>), <span class="co"># |&gt;</span></span>
<span id="cb14-22"><a href="data-cleaning.html#cb14-22" tabindex="-1"></a>                 <span class="co"># filter(.otl == TRUE),</span></span>
<span id="cb14-23"><a href="data-cleaning.html#cb14-23" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> longitude,</span>
<span id="cb14-24"><a href="data-cleaning.html#cb14-24" tabindex="-1"></a>                 <span class="at">y =</span> latitude)) <span class="sc">+</span> <span class="co">#,</span></span>
<span id="cb14-25"><a href="data-cleaning.html#cb14-25" tabindex="-1"></a>                 <span class="co"># colour = .otl))+</span></span>
<span id="cb14-26"><a href="data-cleaning.html#cb14-26" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb14-27"><a href="data-cleaning.html#cb14-27" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Carex acuta&quot;</span>)</span></code></pre></div>
<!-- I think some form of leaflet plot would be great here so that it is interactive -->
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-cleaning.html#cb15-1" tabindex="-1"></a></span>
<span id="cb15-2"><a href="data-cleaning.html#cb15-2" tabindex="-1"></a>grid_Sweden <span class="ot">&lt;-</span> <span class="fu">makeGrid</span>(Sweden, <span class="dv">25</span>)</span>
<span id="cb15-3"><a href="data-cleaning.html#cb15-3" tabindex="-1"></a></span>
<span id="cb15-4"><a href="data-cleaning.html#cb15-4" tabindex="-1"></a>OB <span class="ot">&lt;-</span> <span class="fu">organiseBirds</span>(Carex, </span>
<span id="cb15-5"><a href="data-cleaning.html#cb15-5" tabindex="-1"></a>                    <span class="at">idCols =</span> <span class="fu">c</span>(<span class="st">&quot;locality&quot;</span>),</span>
<span id="cb15-6"><a href="data-cleaning.html#cb15-6" tabindex="-1"></a>                    <span class="at">xyCols =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>),</span>
<span id="cb15-7"><a href="data-cleaning.html#cb15-7" tabindex="-1"></a>                    <span class="at">sppCol =</span> <span class="st">&quot;SpeciesDyn&quot;</span>)</span>
<span id="cb15-8"><a href="data-cleaning.html#cb15-8" tabindex="-1"></a></span>
<span id="cb15-9"><a href="data-cleaning.html#cb15-9" tabindex="-1"></a>SB <span class="ot">&lt;-</span> <span class="fu">summariseBirds</span>(OB, grid_Sweden)</span>
<span id="cb15-10"><a href="data-cleaning.html#cb15-10" tabindex="-1"></a>grid_Sweden <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(grid_Sweden)</span>
<span id="cb15-11"><a href="data-cleaning.html#cb15-11" tabindex="-1"></a>Sweden_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(Sweden)</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-cleaning.html#cb16-1" tabindex="-1"></a><span class="fu">library</span>(colorRamps)</span>
<span id="cb16-2"><a href="data-cleaning.html#cb16-2" tabindex="-1"></a>SB_SPat <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(SB<span class="sc">$</span>spatial)</span>
<span id="cb16-3"><a href="data-cleaning.html#cb16-3" tabindex="-1"></a></span>
<span id="cb16-4"><a href="data-cleaning.html#cb16-4" tabindex="-1"></a>nSpecies <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> SB_SPat,<span class="fu">aes</span>(<span class="at">fill =</span> nSpp)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="data-cleaning.html#cb16-5" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb16-6"><a href="data-cleaning.html#cb16-6" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-7"><a href="data-cleaning.html#cb16-7" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">matlab.like2</span>(<span class="dv">100</span>))</span>
<span id="cb16-8"><a href="data-cleaning.html#cb16-8" tabindex="-1"></a></span>
<span id="cb16-9"><a href="data-cleaning.html#cb16-9" tabindex="-1"></a>nVisits <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> SB_SPat,<span class="fu">aes</span>(<span class="at">fill =</span> nVis)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="data-cleaning.html#cb16-10" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb16-11"><a href="data-cleaning.html#cb16-11" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="data-cleaning.html#cb16-12" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">matlab.like2</span>(<span class="dv">100</span>))</span>
<span id="cb16-13"><a href="data-cleaning.html#cb16-13" tabindex="-1"></a></span>
<span id="cb16-14"><a href="data-cleaning.html#cb16-14" tabindex="-1"></a>nObs <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> SB_SPat,<span class="fu">aes</span>(<span class="at">fill =</span> nObs)) <span class="sc">+</span></span>
<span id="cb16-15"><a href="data-cleaning.html#cb16-15" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb16-16"><a href="data-cleaning.html#cb16-16" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span></span>
<span id="cb16-17"><a href="data-cleaning.html#cb16-17" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">matlab.like2</span>(<span class="dv">100</span>))</span>
<span id="cb16-18"><a href="data-cleaning.html#cb16-18" tabindex="-1"></a></span>
<span id="cb16-19"><a href="data-cleaning.html#cb16-19" tabindex="-1"></a><span class="fu">plot_grid</span>(nSpecies, nVisits, nObs, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="biodiversity-analysis-tools_files/figure-html/plot_ign-1.png" width="\textwidth" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-hodgetts_annotated_2020" class="csl-entry">
Hodgetts, N. G., Lars Söderström, T. L. Blockeel, S. Caspari, Michael S. Ignatov, N. A. Konstantinova, N. Lockhart, Beáta Papp, Christian Schröck, and Manuela Sim-Sim. 2020. <span>“An Annotated Checklist of Bryophytes of <span>Europe</span>, <span>Macaronesia</span> and <span>Cyprus</span>.”</span> <em>Journal of Bryology</em> 42 (1): 1–116.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-importance-of-questions-and-sources-of-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="fitness-for-use.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
